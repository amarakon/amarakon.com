---
title: How to Install Gentoo Linux – The Efficient Way
author: ~
date: '2022-05-03'
slug: how-to-install-gentoo-linux-the-efficient-way
categories: ["Operating systems", "Tutorial"]
tags: ["foss", "tutorial"]
bibliography: ../../../static/bibliography.bib
csl: ../../../static/citations/apa-no-initials.csl
link-citations: true
reference-section-title: References
nocite: ["@gentoohandbook"]
---



<p>So you finally moved from the beginner distributions and you know want to install truly the best operating system of all time; Gentoo Linux.
Contrary to popular belief, installing this operating system is not difficult in the slightest but it is certainly time consuming.
Usually it will take around five hours to install.
This might deter you, but remember that this operating system will actually save you time in the long run.
Not only is it faster than other operating systems, it also makes the user more intelligent, leading to efficient computer usage.
No current Gentoo user regrets spending five hours installing the operating system to save many more hours in total.</p>
<p>For this installation tutorial, you will need to have an existing Unix-like operating system—like any Linux distribution.
Before I get to the beginning of the installation process, there are a few things you must know.
First, you have to care about computing for the installation of Gentoo to be worth it.
Second, please view the <a href="https://wiki.gentoo.org/wiki/Handbook:Main_Page">Gentoo handbook</a> while you are watching this video.
It is unlikely but possible that some of the information in this video will be outdated.
The Gentoo wiki also has many details that I will not go into because they are not important enough.
Third, you need to know the architecture of your computer’s CPU, usually it is AMD64.
Finally, you must know whether your computer firmware uses BIOS or UEFI.
Generally, only extremely old computers support only BIOS, only terrible new computers support only UEFI, and most computers support both.
You should be completely sure though to avoid messing your entire installation.</p>
<div id="prepare-the-disks" class="section level1">
<h1>Prepare the Disks</h1>
<p>Obviously, since Gentoo requires installation from the command-line, you will need to open a terminal.
Use the <code>lsblk</code> command do check the available block devices.
To be cautious, you can unplug any storage devices you do not want to accidentally wipe.
Also make sure to know which block device your current running operating system so you do not accidentally wipe that either.
Use the <code>wipefs</code> command to wipe a block device if it already has a partition scheme.
Then use the <code>cfdisk</code> command to begin partitioning.</p>
<pre class="sh"><code>$ lsblk
# wipefs -a /dev/*NAME*
# cfdisk /dev/*NAME*</code></pre>
<p>If you’re using BIOS, select DOS.
And if you’re using UEFI, select GPT.
If you’re using BIOS, all you need is one partition.
If you’re using UEFI, you need to make a partition that is at least 128 MB, this will be the boot partition.
You should label this partition “EFI system.”
Then create the second partition using the rest of the space.</p>
<p>Once you exited cfdisk, you need to format your partitions.
If you’re using BIOS, all you have to do is format your one partition as ext4 or any other usable file system you prefer:</p>
<pre class="sh"><code># mkfs.ext4 /dev/*NAME*1</code></pre>
<p>If you’re using UEFI, you must format your first partition as VFAT and your second partition your preferred file system:</p>
<pre class="sh"><code># mkfs.fat -F 32 /dev/*NAME*1
# mkfs.ext4 /dev/*NAME*2</code></pre>
<p>If you’re using BIOS, mount the root partition:</p>
<pre class="sh"><code>mkdir /mnt/gentoo
mount /dev/*NAME*2 /mnt/gentoo</code></pre>
<p>If you’re using UEFI, mount the root partition and the boot partition:</p>
<pre class="sh"><code># mkdir /mnt/gentoo
# mount /dev/*NAME*2 /mnt/gentoo
# mount /dev/*NAME*1 /mnt/gentoo/boot</code></pre>
</div>
<div id="installing-the-gentoo-installation-files" class="section level1">
<h1>Installing the Gentoo Installation Files</h1>
<p>Temporarily set the correct date and time using the <code>MMDDhhmmYYYY</code> syntax:</p>
<pre class="sh"><code># date *MMDDhhmmYYYY*</code></pre>
<p>Go to the <a href="https://www.gentoo.org/downloads/#other-arches">download section</a> of the Gentoo wiki and copy the link of a stage tarball.
I recommend the standard Stage 3 OpenRC.
Download the tarball to <code>/mnt/gentoo</code> using the link you copied.
Decompress the archive afterwards.</p>
<pre class="sh"><code>$ cd /mnt/gentoo
# wget *URL*
# tar xpvf stage3-*.tar.xz --xattrs-include=&#39;*.*&#39; --numeric-owner</code></pre>
<p>Run <code># nano /mnt/gentoo/etc/portage/make.conf</code>.
Set march equal to native.
The <code>-j</code> flag means the amount of threads you want Portage, the package manager to use.
The <code>-l</code> flag means the load average.
The <code>PORTAGE_NICENESS</code> option refers to how much priority portage should have (the higher the number, the higher the priority).
Setting <code>ACCEPT_KEYWORDS="~amd64"</code> will allow portage to install bleeding edge software.
The <code>VIDEO_CARDS</code> option is dependent on your video card <span class="citation">(<a href="#ref-gentoocard" role="doc-biblioref">Gentoo, 2020</a>)</span>.
The <code>USE</code> flags are for features you want or do not want in your packages.
The <code>GRUB_PLATFORMS</code> option should be set to <code>"pc"</code> for BIOS and <code>"efi-64"</code> or <code>"efi-32"</code> for UEFI.
Copy everything else I did.</p>
<pre class="gentoo"><code>COMMON_FLAGS=&quot;-march=native -O2 -pipe&quot;
CFLAGS=&quot;${COMMON_FLAGS}&quot;
CXXFLAGS=&quot;${COMMON_FLAGS}&quot;

MAKEOPTS=&quot;-j2 -l3.6&quot;
EMERGE_DEFAULT_OPTS=&quot;-j2 -l3.6&quot;
PORTAGE_NICENESS=&quot;1&quot;
ACCEPT_KEYWORDS=&quot;~amd64&quot;
VIDEO_CARDS=&quot;intel i915 i965&quot;
USE=&quot;X pulseaudio savedconfig -bluetooth -geolocation -drm&quot;

# NOTE: This stage was built with the bindist Use flag enabled
PORTDIR=&quot;/var/db/repos/gentoo&quot;
DISTDIR=&quot;/var/cache/distfiles&quot;
PKGDIR=&quot;/var/cache/binpkgs&quot;

# This sets the language of build output to English.
# Please keep this setting intact when reporting bugs.
LC_MESSAGES=C
L10N=&quot;&quot;

# Other
GRUB_PLATFORMS=&quot;pc&quot;
GENTOO_MIRRORS=&quot;https://mirror.csclub.uwaterloo.ca/gentoo-distfiles/ https://gentoo.osuosl.org/ https://mirrors.rit.edu/gentoo/ http://mirror.csclub.uwaterloo.ca/gentoo-distfiles/ http://gentoo.osuosl.org/ http://mirrors.rit.edu/gentoo/&quot;</code></pre>
</div>
<div id="installing-the-base" class="section level1">
<h1>Installing the Base</h1>
<p>Set up the <em>gentoo</em> repository:</p>
<pre class="sh"><code># mkdir -p /mnt/gentoo/etc/portage/repos.conf
# cp /mnt/gentoo/usr/share/portage/config/repos.conf /mnt/gentoo/etc/portage/repos.conf/gentoo.conf
# cp --dereference /etc/resolv.conf /mnt/gentoo/etc/</code></pre>
<p>Mount necessary file systems:</p>
<pre class="sh"><code># mount --types proc /proc /mnt/gentoo/proc
# mount --rbind /sys /mnt/gentoo/sys
# mount --make-rslave /mnt/gentoo/sys
# mount --rbind /dev /mnt/gentoo/dev
# mount --make-rslave /mnt/gentoo/dev
# mount --bind /run /mnt/gentoo/run
# mount --make-slave /mnt/gentoo/run </code></pre>
<p>Enter the new installation environment by chrooting into it:</p>
<pre class="sh"><code># chroot /mnt/gentoo /bin/bash
# source /etc/profile
# export PS1=&quot;(chroot) ${PS1}&quot;</code></pre>
<p>Installing a Gentoo ebuild repository snapshot from the web and update it:</p>
<pre class="sh"><code># emerge-webrsync
# emerge --sync</code></pre>
<p>Update the @set (all of your packages).
This will take a lot of time.
If you get a circular dependency error, which is not uncommon, consult the Gentoo wiki <span class="citation">(<a href="#ref-gentoocircle" role="doc-biblioref">Gentoo, 2022a</a>)</span>:</p>
<pre class="sh"><code># emerge -uDN @world </code></pre>
<p>Select the time zone for the system.
Look for the available time zones in <code>/usr/share/zoneinfo/</code>.
I chose <code>America/Toronto</code>.</p>
<pre class="sh"><code>$ ls /usr/share/zoneinfo
# echo &quot;America/Toronto&quot; &gt; /etc/timezone
# emerge --config sys-libs/timezone-data</code></pre>
<p>Choose the right locale by running <code># nano /etc/locale.gen</code>:</p>
<pre class="sh"><code>en_CA.UTF-8 UTF-8</code></pre>
<pre class="sh"><code>locale-gen</code></pre>
<p>Check the locale list by running <code>$ eselect locale list</code>, then select the right one:</p>
<pre class="gentoo"><code>Available targets for the LANG variable:
  [1]   C
  [2]   C.utf8
  [3]   en_CA.utf8
  [4]   POSIX
  [ ]   (free form)</code></pre>
<pre class="sh"><code># eselect locale set 3</code></pre>
<p>Reload the environment:</p>
<pre class="sh"><code># env-update &amp;&amp; source /etc/profile &amp;&amp; export PS1=&quot;(chroot) ${PS1}&quot;</code></pre>
</div>
<div id="install-the-kernel" class="section level1">
<h1>Install the Kernel</h1>
<p>The easiest way to install the kernel is by installing the gentoo-kernel package.
If you wan to customize the kernel, check the Gentoo handbook page on configuring the Linux kernel <span class="citation">(<a href="#ref-gentookernel" role="doc-biblioref">Gentoo, 2015</a>)</span>
If you need Linux firmware (you most likely do), then install the linux-firmware package.</p>
<pre class="sh"><code># emerge gentoo-kernel linux-firmware</code></pre>
</div>
<div id="configure-the-system" class="section level1">
<h1>Configure the System</h1>
<p>You need to set up fstab:</p>
<pre class="sh"><code># blkid &gt; /etc/fstab</code></pre>
<p>Open the file by running <code># nano /etc/fstab</code>. If you have an SSD, you should enable the <code>noatime</code> and <code>discard</code> options.
If you are using BIOS, arrange your fstab to something like this:</p>
<pre><code># /dev/sda1
UUID=9167fa6f-bb77-4337-a547-48a20506d297   /   ext4    noatime,discard 0 1</code></pre>
<p>If you are using UEFI, do something like this instead:</p>
<pre><code># /dev/sda1
UUID=dbb15f21-c203-4665-a520-7f92f51661ae   /boot   vfat    defaults,noatime     0 2

# /dev/sda2
UUID=9167fa6f-bb77-4337-a547-48a20506d297   /   ext4    noatime,discard 0 1</code></pre>
<p>Set the host name by running <code># nano /etc/conf.d/hostname</code>:</p>
<pre><code>hostname=&quot;*host name*&quot;</code></pre>
<p>Install NetworkManager and add it to the default runlevel for internet connection:</p>
<pre class="sh"><code># emerge net-misc/networkmanager
# rc-update add NetworkManager default</code></pre>
<p>Edit the hosts file by running <code># nano /etc/hosts</code>:</p>
<pre><code>127.0.0.1   localhost
::1         localhost
127.0.1.1   *host name*</code></pre>
<p>Set the root password by simply running <code># passwd</code>.</p>
</div>
<div id="configure-the-bootloader" class="section level1">
<h1>Configure the Bootloader</h1>
<p>You now need to install a bootloader, the most common one is GRUB.
When using BIOS:</p>
<pre class="sh"><code># emerge sys-boot/grub
# grub-install /dev/*NAME*
# grub-mkconfig -o /boot/grub/grub.cfg</code></pre>
<p>When using UEFI:</p>
<pre class="sh"><code># emerge sys-boot/grub
# grub-install --target=x86_64-efi --efi-directory=/boot
# grub-mkconfig -o /boot/grub/grub.cfg</code></pre>
<div id="reboot-the-system" class="section level2">
<h2>Reboot the system</h2>
<pre class="sh"><code># exit</code></pre>
<pre class="sh"><code># cd
# umount -l /mnt/gentoo/dev{/shm,/pts,} 
# umount -R /mnt/gentoo
# reboot</code></pre>
</div>
</div>
<div id="finalize-the-installation" class="section level1">
<h1>Finalize the Installation</h1>
<p>First, log in as root:</p>
<pre><code>Login: root
Password: *password*</code></pre>
<p>Add a user for daily use and set its password:</p>
<pre class="sh"><code># useradd -mG wheel,news,audio,video,portage *user*
# passwd *user*</code></pre>
<p>Finally, remove the now unneeded tarball from the root directory:</p>
<pre class="sh"><code># rm /stage3-*.tar.*</code></pre>
<p>Congratulations, you have successfully completed the installation of Gentoo Linux.
But do not get too excited, because we are not technically done yet.</p>
<div id="graphical-environment" class="section level2">
<h2>Graphical Environment</h2>
<p>Now all you need to do is install a display server, xinit or a desktop manager, and a window manager or a desktop environment.</p>
<pre class="sh"><code># emerge x11-base/xorg-server x11-apps/xinit x11-wm/dwm
$ echo &quot;exec dwm&quot; &gt; ~/.xinitrc
$ startx</code></pre>
</div>
</div>
<div id="bibliography" class="section level1 unnumbered">
<h1>References</h1>
<div id="refs" class="references csl-bib-body hanging-indent" line-spacing="2">
<div id="ref-gentookernel" class="csl-entry">
Gentoo. (2015). <em>Configuring the linux kernel</em>. <a href="https://wiki.gentoo.org/wiki/Handbook:AMD64/Installation/Kernel">https://wiki.gentoo.org/wiki/Handbook:AMD64/Installation/Kernel</a>
</div>
<div id="ref-gentoocard" class="csl-entry">
Gentoo. (2020). <em>Video cards</em>. <a href="https://wiki.gentoo.org/wiki/Category:Video_cards">https://wiki.gentoo.org/wiki/Category:Video_cards</a>
</div>
<div id="ref-gentoocircle" class="csl-entry">
Gentoo. (2022a). <em>Circular dependencies</em>. <a href="https://wiki.gentoo.org/wiki/User:Sam/Portage_help/Circular_dependencies">https://wiki.gentoo.org/wiki/User:Sam/Portage_help/Circular_dependencies</a>
</div>
<div id="ref-gentoohandbook" class="csl-entry">
Gentoo. (2022b). <em>Gentoo AMD64 handbook</em>. <a href="https://wiki.gentoo.org/wiki/Handbook:AMD64">https://wiki.gentoo.org/wiki/Handbook:AMD64</a>
</div>
</div>
</div>
